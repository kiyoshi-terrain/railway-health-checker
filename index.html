<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš‚ é‰„é“åœŸæ§‹é€ ç‰©å¥å…¨åº¦è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ  v3</title>
    <link rel="stylesheet" href="railway-styles.css">
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p style="font-size: 1.2em;">è§£æä¸­...</p>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>ğŸš‚ é‰„é“åœŸæ§‹é€ ç‰©å¥å…¨åº¦è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ </h1>
            <div class="version">Version 3.0 - ãƒãƒ£ãƒƒãƒˆå¼AIè¨ºæ–­å¯¾å¿œ</div>
        </div>
        
        <!-- ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
        <div class="mode-selector">
            <button class="mode-button" onclick="setMode('auto')">
                <span class="icon">ğŸ¤–</span>
                è‡ªå‹•è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰
                <br>
                <small style="font-size: 0.8em; font-weight: normal;">åº§æ¨™ã‹ã‚‰è‡ªå‹•ã§å¥å…¨åº¦ã‚’è©•ä¾¡</small>
            </button>
            <button class="mode-button active" onclick="setMode('inspection')">
                <span class="icon">ğŸ‘·</span>
                ç‚¹æ¤œè©•ä¾¡ãƒ¢ãƒ¼ãƒ‰
                <br>
                <small style="font-size: 0.8em; font-weight: normal;">ç¶­æŒç®¡ç†æ¨™æº–ã«åŸºã¥ãè©•ä¾¡</small>
            </button>
        </div>
        
        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="main-content">
            <!-- è‡ªå‹•è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰ -->
            <div class="auto-mode">
                <h2 style="color: #2a5298; margin-bottom: 20px;">ğŸ¤– è‡ªå‹•è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰</h2>
                <p style="margin-bottom: 30px;">åº§æ¨™ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€åœ°å½¢ãƒ»åœ°è³ªãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•çš„ã«åœŸæ§‹é€ ç‰©ã®å¥å…¨åº¦ã‚’è©•ä¾¡ã—ã¾ã™ã€‚</p>
                
                <div style="text-align: center; padding: 50px;">
                    <button class="execute-button" onclick="window.location.href='railway-health-checker.html'">
                        å¾“æ¥ã®è‡ªå‹•è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•
                    </button>
                </div>
            </div>
            
            <!-- ç‚¹æ¤œè©•ä¾¡ãƒ¢ãƒ¼ãƒ‰ -->
            <div class="inspection-mode active">
                <h2 style="color: #2a5298; margin-bottom: 20px;">ğŸ‘· ç‚¹æ¤œè©•ä¾¡ãƒ¢ãƒ¼ãƒ‰</h2>
                <p style="margin-bottom: 30px;">ç¾å ´ã§ã®ç‚¹æ¤œçµæœã‚’å…¥åŠ›ã—ã€ç¶­æŒç®¡ç†æ¨™æº–ã«åŸºã¥ã„ã¦å¥å…¨åº¦ã‚’è©•ä¾¡ã—ã¾ã™ã€‚</p>
                
                <!-- åŸºæœ¬æƒ…å ±å…¥åŠ› -->
                <div class="basic-info" id="basicInfo">
                    <h3 onclick="toggleBasicInfo()">ğŸ“ èª¿æŸ»å¯¾è±¡åœŸæ§‹é€ ç‰© è«¸å…ƒãƒ‡ãƒ¼ã‚¿</h3>
                    <div class="basic-info-content">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>ã®ã‚Šé¢ç®¡ç†ç•ªå·</label>
                                <input type="text" id="managementNumber" placeholder="ä¾‹ï¼šä¸Šã‚Š4">
                            </div>
                            <div class="form-group">
                                <label>ç·šå</label>
                                <select id="lineName">
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    <option value="custom">æ‰‹å‹•å…¥åŠ›...</option>
                                    <option value="æ±æµ·é“ç·š">æ±æµ·é“ç·š</option>
                                    <option value="æ¨ªé ˆè³€ç·š">æ¨ªé ˆè³€ç·š</option>
                                    <option value="ä¸­å¤®ç·š">ä¸­å¤®ç·š</option>
                                </select>
                                <input type="text" id="lineNameCustom" style="display:none; margin-top:10px;" placeholder="ç·šåã‚’å…¥åŠ›">
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>é§…é–“</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <input type="text" id="stationFrom" placeholder="èµ·ç‚¹é§…å" style="flex: 1;">
                                    <span>ï½</span>
                                    <input type="text" id="stationTo" placeholder="çµ‚ç‚¹é§…å" style="flex: 1;">
                                </div>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>ã‚­ãƒ­ç¨‹</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <input type="text" id="kmFrom" placeholder="ä¾‹ï¼š1k442m" style="flex: 1;">
                                    <span>ï½</span>
                                    <input type="text" id="kmTo" placeholder="ä¾‹ï¼š1k486m" style="flex: 1;">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>å¯¾è±¡ï¼ˆæ§‹é€ ç‰©ç¨®åˆ¥ï¼‰</label>
                                <select id="structureType" onchange="updateChecklists()">
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    <option value="embankment">ç››åœŸ</option>
                                    <option value="cutting">åˆ‡åœŸ</option>
                                    <option value="natural">è‡ªç„¶æ–œé¢</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>å ´æ‰€ï¼ˆç·šåˆ¥ï¼‰</label>
                                <select id="location">
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    <option value="up-line">ä¸Šã‚Šç·šå´</option>
                                    <option value="down-line">ä¸‹ã‚Šç·šå´</option>
                                    <option value="left-side">å·¦å´</option>
                                    <option value="right-side">å³å´</option>
                                    <option value="both">ä¸¡å´</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>èª¿æŸ»æ—¥</label>
                                <input type="date" id="surveyDate" value="">
                            </div>
                            <div class="form-group">
                                <label>å¤©å€™</label>
                                <select id="weather">
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    <option value="æ™´">æ™´</option>
                                    <option value="æ›‡">æ›‡</option>
                                    <option value="é›¨">é›¨</option>
                                    <option value="é›ª">é›ª</option>
                                    <option value="éœ§">éœ§</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ç·¯åº¦ï¼ˆä»»æ„ï¼‰</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="number" id="latitude" step="0.000001" placeholder="35.123456" style="flex: 1;">
                                    <button type="button" class="gps-button" onclick="getCurrentLocation()">
                                        ğŸ“ ç¾åœ¨åœ°
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>çµŒåº¦ï¼ˆä»»æ„ï¼‰</label>
                                <input type="number" id="longitude" step="0.000001" placeholder="139.123456">
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; text-align: right;">
                            <button type="button" class="export-button" onclick="exportSurveySheet()">
                                ğŸ“„ èª¿æŸ»ç¥¨å½¢å¼ã§å‡ºåŠ›
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- å¥å…¨åº¦ã®åˆ¤å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="assessment-section" id="assessmentSection">
                    <h3 onclick="toggleAssessmentSection()">ğŸ¥ å¥å…¨åº¦ã®åˆ¤å®š</h3>
                    <div class="assessment-section-content">
                        <p class="section-description">
                            å¤‰çŠ¶ãƒ»ä¸å®‰å®šæ€§ã®èª¿æŸ»çµæœã‚’å…¥åŠ›ã™ã‚‹ã‹ã€AIè¨ºæ–­ã§å…¥åŠ›ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã‚„å†™çœŸã‹ã‚‰è‡ªå‹•åˆ¤å®šã§ãã¾ã™ã€‚
                            æœ€æ–°ã®ç¶­æŒç®¡ç†æ¨™æº–ã«åŸºã¥ã„ã¦ã€å¥å…¨åº¦ã‚’Sãƒ»Cãƒ»Bãƒ»Aãƒ»AAã®5æ®µéšã§è©•ä¾¡ã—ã¾ã™ã€‚
                        </p>
                        
                        <!-- ã‚¿ãƒ–ã‚·ã‚¹ãƒ†ãƒ  -->
                        <div class="tabs">
                            <div class="tab active" onclick="switchTab('defects')">ğŸ” å¤‰çŠ¶</div>
                            <div class="tab" onclick="switchTab('instability')">âš ï¸ ä¸å®‰å®šæ€§</div>
                            <div class="tab ai-tab" onclick="switchTab('ai')">ğŸ¤– AIè¨ºæ–­ â˜…</div>
                        </div>
                        
                        <!-- å¤‰çŠ¶ã‚¿ãƒ– -->
                        <div class="tab-content active" id="defects-tab">
                            <div id="defects-checklists-container">
                                <p style="text-align: center; color: #999; padding: 40px;">
                                    æ§‹é€ ç‰©ç¨®åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„
                                </p>
                            </div>
                            
                            <div class="checklist" style="margin-top: 20px;">
                                <h4>ğŸ“ ç‰¹è¨˜äº‹é …</h4>
                                <textarea class="special-notes" id="specialNotes" placeholder="ä¾‹ï¼š
â‘ å½“è©²ãƒ–ãƒ­ãƒƒã‚¯å…¨åŸŸã§å¹ä»˜å·¥ã®å¤‰çŠ¶ã«ã‚ˆã‚‹ãƒ¢ãƒ«ã‚¿ãƒ«ç‰‡ã®å‰¥è½ã®å¯èƒ½æ€§ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã€‚
â‘¡ç·šè·¯å´æºã®æµæœ«ä»˜è¿‘ã§ã‚´ãƒŸç­‰ã®å †ç©ã«ã‚ˆã‚Šé€šæ°´ä¸è‰¯ã‚’ç”Ÿã˜ã€æ»æ°´ã‚‚è¦‹ã‚‰ã‚Œã‚‹ã€‚
â‘¢å…¬è¡†ç½å®³ãŒæ‡¸å¿µã•ã‚Œã‚‹ç®‡æ‰€ã‚ã‚Šã€‚æ—©æ€¥ãªå¯¾ç­–ãŒå¿…è¦ã€‚"></textarea>
                            </div>
                            
                            <div class="checklist" style="margin-top: 20px;">
                                <h4>ğŸ¯ ç·åˆåˆ¤å®š</h4>
                                <div class="overall-judgment">
                                    <select id="overallGrade" class="grade-select">
                                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                        <option value="S">S - å¥å…¨</option>
                                        <option value="C">C - è»½å¾®ãªå¤‰çŠ¶</option>
                                        <option value="B">B - è¦æ³¨æ„</option>
                                        <option value="A">A - è¦å¯¾ç­–</option>
                                        <option value="AA">AA - ç·Šæ€¥å¯¾ç­–å¿…è¦</option>
                                    </select>
                                    <button type="button" class="auto-judge-button" onclick="autoJudgeGrade()">
                                        ğŸ¤– è‡ªå‹•åˆ¤å®š
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ä¸å®‰å®šæ€§ã‚¿ãƒ– -->
                        <div class="tab-content" id="instability-tab">
                            <div id="instability-checklists-container">
                                <p style="text-align: center; color: #999; padding: 40px;">
                                    æ§‹é€ ç‰©ç¨®åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„
                                </p>
                            </div>
                            
                            <div class="checklist" style="margin-top: 20px;">
                                <h4>ğŸŒ åœ°å½¢åœ°è³ªãƒ»ç«‹åœ°æ¡ä»¶ãƒ»æ¦‚æ³</h4>
                                <div style="margin-bottom: 10px;">
                                    <button type="button" class="auto-generate-button" onclick="generateGeologicalSummary()">
                                        ğŸ¤– åº§æ¨™ã‹ã‚‰è‡ªå‹•ç”Ÿæˆ
                                    </button>
                                    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">
                                        â€»ç·¯åº¦ãƒ»çµŒåº¦ã‚’å…¥åŠ›ã—ã¦ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„
                                    </span>
                                </div>
                                <textarea id="geologicalSummary" class="geological-summary" placeholder="ï¼œåœ°å½¢ãƒ»åœ°è³ªï¼
èª¿æŸ»å¯¾è±¡åœ°ã¯ã€â—‹â—‹åœ°ã®â—‹â—‹éƒ¨ã‚’é€šéã™ã‚‹åŒºé–“ã§ã‚ã‚‹ã€‚
åœ°è³ªã¯â—‹â—‹ãŒåˆ†å¸ƒã—ã¦ã„ã‚‹ã€‚

ï¼œç«‹åœ°æ¡ä»¶ï¼
ç·šè·¯æ•·ãã®â—‹å´ãŒâ—‹â—‹ã«æ¥ã—ã¦ãŠã‚Šã€â—‹å´ã¯â—‹â—‹ãŒã‚ã‚‹ã€‚

ï¼œæ¦‚æ³ï¼
å½“è©²ç®‡æ‰€ã¯ã€â—‹â—‹ãŒå¯¾è±¡ã§ã‚ã‚‹ã€‚"></textarea>
                            </div>
                            
                            <div class="checklist" style="margin-top: 20px;">
                                <h4>âš ï¸ æƒ³å®šè¢«ç½å½¢æ…‹</h4>
                                <div class="disaster-form-grid">
                                    <div class="form-group">
                                        <label>å½¢æ…‹</label>
                                        <select id="disasterType">
                                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                            <option value="è¡¨å±¤å´©å£Š">è¡¨å±¤å´©å£Š</option>
                                            <option value="æ·±ã„ã™ã¹ã‚Šå´©å£Š">æ·±ã„ã™ã¹ã‚Šå´©å£Š</option>
                                            <option value="åœŸç ‚å´©å£Š">åœŸç ‚å´©å£Š</option>
                                            <option value="å²©ç›¤å´©å£Š">å²©ç›¤å´©å£Š</option>
                                            <option value="ä¾µé£Ÿå´©å£Š">ä¾µé£Ÿå´©å£Š</option>
                                            <option value="åœŸçŸ³æµ">åœŸçŸ³æµ</option>
                                            <option value="è½çŸ³">è½çŸ³</option>
                                            <option value="å¹ä»˜å·¥ã®å‰¥è½">å¹ä»˜å·¥ã®å‰¥è½</option>
                                            <option value="ãã®ä»–">ãã®ä»–</option>
                                        </select>
                                        <input type="text" id="disasterTypeOther" style="display:none; margin-top:10px;" placeholder="ãã®ä»–ã®è¢«ç½å½¢æ…‹ã‚’å…¥åŠ›">
                                    </div>
                                    <div class="form-group">
                                        <label>ç™ºç”Ÿç®‡æ‰€</label>
                                        <input type="text" id="disasterLocation" placeholder="ä¾‹ï¼šå…¨åŸŸã€ä¸Šã‚Š4">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- AIè¨ºæ–­ã‚¿ãƒ– -->
                        <div class="tab-content" id="ai-tab">
                            <div class="ai-chat-container">
                                <!-- ãƒãƒ£ãƒƒãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ -->
                                <div class="chat-header">
                                    <h3>ğŸ¤– AIè¨ºæ–­ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</h3>
                                    <p>ç¾å ´ã®çŠ¶æ³ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚ç¶­æŒç®¡ç†æ¨™æº–ã«åŸºã¥ã„ã¦å¥å…¨åº¦ã‚’åˆ¤å®šã—ã¾ã™ã€‚</p>
                                </div>
                                
                                <!-- ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
                                <div class="chat-messages" id="chatMessages">
                                    <!-- åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                                    <div class="message bot-message">
                                        <div class="message-avatar">ğŸ¤–</div>
                                        <div class="message-content">
                                            <div class="message-bubble">
                                                ã“ã‚“ã«ã¡ã¯ï¼é‰„é“åœŸæ§‹é€ ç‰©ã®å¥å…¨åº¦è¨ºæ–­ã‚’ãŠæ‰‹ä¼ã„ã—ã¾ã™ã€‚<br><br>
                                                ä»¥ä¸‹ã®æƒ…å ±ã‚’æ•™ãˆã¦ãã ã•ã„ï¼š<br>
                                                ğŸ“ ç¾å ´ã®çŠ¶æ³èª¬æ˜<br>
                                                ğŸ“¸ ç¾å ´ã®å†™çœŸ<br>
                                                ğŸ“ GPSä½ç½®æƒ…å ±<br><br>
                                                ã¾ãšã¯ã€ã©ã®ã‚ˆã†ãªå¤‰çŠ¶ã‚„ä¸å®‰å®šæ€§ãŒè¦‹ã‚‰ã‚Œã¾ã™ã‹ï¼Ÿ
                                            </div>
                                            <div class="message-time"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
                                <div class="chat-input-container">
                                    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                                    <div class="chat-actions">
                                        <button class="action-btn" onclick="attachPhoto()" title="å†™çœŸã‚’æ·»ä»˜">
                                            ğŸ“¸
                                        </button>
                                        <button class="action-btn" onclick="attachLocation()" title="ç¾åœ¨åœ°ã‚’é€ä¿¡">
                                            ğŸ“
                                        </button>
                                        <input type="file" id="chatPhotoInput" accept="image/*" multiple style="display: none;" onchange="handleChatPhotoUpload(event)">
                                    </div>
                                    
                                    <!-- ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› -->
                                    <div class="chat-input-wrapper">
                                        <textarea 
                                            id="chatInput" 
                                            class="chat-input" 
                                            placeholder="ç¾å ´ã®çŠ¶æ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."
                                            rows="1"
                                            onkeypress="handleChatKeyPress(event)"
                                            oninput="adjustTextareaHeight(this)"></textarea>
                                        <button class="send-btn" onclick="sendMessage()" id="sendButton">
                                            <span class="send-icon">â¤</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                                <div class="attachment-preview" id="attachmentPreview" style="display: none;">
                                    <div class="attachment-header">
                                        <span>æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«</span>
                                        <button onclick="clearAttachments()" class="clear-attachments">âœ•</button>
                                    </div>
                                    <div class="attachment-items" id="attachmentItems"></div>
                                </div>
                            </div>
                            
                            <!-- ãƒãƒ£ãƒƒãƒˆç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« -->
                            <style>
                            /* ãƒãƒ£ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠ */
                            .ai-chat-container {
                                height: 600px;
                                display: flex;
                                flex-direction: column;
                                background: #f5f5f5;
                                border-radius: 15px;
                                overflow: hidden;
                            }
                            
                            /* ãƒãƒ£ãƒƒãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ */
                            .chat-header {
                                background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
                                color: white;
                                padding: 20px;
                                text-align: center;
                            }
                            
                            .chat-header h3 {
                                margin: 0 0 10px 0;
                                font-size: 1.4em;
                            }
                            
                            .chat-header p {
                                margin: 0;
                                font-size: 0.9em;
                                opacity: 0.9;
                            }
                            
                            /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ */
                            .chat-messages {
                                flex: 1;
                                overflow-y: auto;
                                padding: 20px;
                                background: #ffffff;
                            }
                            
                            /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ã‚¿ã‚¤ãƒ« */
                            .message {
                                display: flex;
                                margin-bottom: 20px;
                                animation: fadeIn 0.3s ease-in;
                            }
                            
                            @keyframes fadeIn {
                                from { opacity: 0; transform: translateY(10px); }
                                to { opacity: 1; transform: translateY(0); }
                            }
                            
                            .bot-message {
                                justify-content: flex-start;
                            }
                            
                            .user-message {
                                justify-content: flex-end;
                            }
                            
                            .message-avatar {
                                width: 40px;
                                height: 40px;
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 1.5em;
                                margin: 0 10px;
                                flex-shrink: 0;
                            }
                            
                            .bot-message .message-avatar {
                                background: #e3f2fd;
                                order: 0;
                            }
                            
                            .user-message .message-avatar {
                                background: #e8f5e9;
                                order: 1;
                            }
                            
                            .message-content {
                                max-width: 70%;
                            }
                            
                            .message-bubble {
                                padding: 15px;
                                border-radius: 15px;
                                word-wrap: break-word;
                            }
                            
                            .bot-message .message-bubble {
                                background: #f0f4ff;
                                border-bottom-left-radius: 5px;
                            }
                            
                            .user-message .message-bubble {
                                background: #2a5298;
                                color: white;
                                border-bottom-right-radius: 5px;
                            }
                            
                            .message-time {
                                font-size: 0.75em;
                                color: #999;
                                margin-top: 5px;
                                text-align: right;
                            }
                            
                            .user-message .message-time {
                                text-align: left;
                            }
                            
                            /* ç”»åƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
                            .message-image {
                                max-width: 200px;
                                max-height: 200px;
                                border-radius: 10px;
                                cursor: pointer;
                                margin-top: 10px;
                            }
                            
                            /* ä½ç½®æƒ…å ±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
                            .location-message {
                                display: flex;
                                align-items: center;
                                gap: 10px;
                                padding: 10px;
                                background: #e8f5e9;
                                border-radius: 10px;
                                margin-top: 10px;
                            }
                            
                            /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
                            .chat-input-container {
                                border-top: 1px solid #e0e0e0;
                                background: white;
                                padding: 15px;
                            }
                            
                            .chat-actions {
                                display: flex;
                                gap: 10px;
                                margin-bottom: 10px;
                            }
                            
                            .action-btn {
                                width: 40px;
                                height: 40px;
                                border: none;
                                background: #f0f0f0;
                                border-radius: 50%;
                                cursor: pointer;
                                font-size: 1.2em;
                                transition: all 0.3s;
                            }
                            
                            .action-btn:hover {
                                background: #e0e0e0;
                                transform: scale(1.1);
                            }
                            
                            .chat-input-wrapper {
                                display: flex;
                                align-items: flex-end;
                                gap: 10px;
                            }
                            
                            .chat-input {
                                flex: 1;
                                border: 2px solid #e0e0e0;
                                border-radius: 25px;
                                padding: 12px 20px;
                                font-size: 16px;
                                resize: none;
                                max-height: 120px;
                                transition: border-color 0.3s;
                            }
                            
                            .chat-input:focus {
                                outline: none;
                                border-color: #2a5298;
                            }
                            
                            .send-btn {
                                width: 45px;
                                height: 45px;
                                border: none;
                                background: #2a5298;
                                color: white;
                                border-radius: 50%;
                                cursor: pointer;
                                transition: all 0.3s;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            }
                            
                            .send-btn:hover {
                                background: #1e3c72;
                                transform: scale(1.05);
                            }
                            
                            .send-btn:disabled {
                                background: #ccc;
                                cursor: not-allowed;
                            }
                            
                            .send-icon {
                                font-size: 1.2em;
                            }
                            
                            /* æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
                            .attachment-preview {
                                position: absolute;
                                bottom: 100%;
                                left: 0;
                                right: 0;
                                background: white;
                                border: 1px solid #e0e0e0;
                                border-bottom: none;
                                border-radius: 10px 10px 0 0;
                                padding: 10px;
                                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                            }
                            
                            .attachment-header {
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                margin-bottom: 10px;
                            }
                            
                            .clear-attachments {
                                background: none;
                                border: none;
                                font-size: 1.2em;
                                cursor: pointer;
                                color: #999;
                            }
                            
                            .attachment-items {
                                display: flex;
                                gap: 10px;
                                flex-wrap: wrap;
                            }
                            
                            .attachment-item {
                                width: 60px;
                                height: 60px;
                                border-radius: 8px;
                                overflow: hidden;
                                position: relative;
                            }
                            
                            .attachment-item img {
                                width: 100%;
                                height: 100%;
                                object-fit: cover;
                            }
                            
                            /* è¨ºæ–­çµæœã®ç‰¹åˆ¥ãªã‚¹ã‚¿ã‚¤ãƒ« */
                            .diagnosis-result {
                                background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                                padding: 20px;
                                border-radius: 10px;
                                margin-top: 10px;
                            }
                            
                            .diagnosis-grade {
                                display: inline-block;
                                padding: 5px 15px;
                                border-radius: 20px;
                                font-weight: bold;
                                margin: 5px 0;
                            }
                            
                            .grade-AA { background: #ff4444; color: white; }
                            .grade-A { background: #ff9800; color: white; }
                            .grade-B { background: #ffeb3b; color: black; }
                            .grade-C { background: #4caf50; color: white; }
                            .grade-S { background: #2196f3; color: white; }
                            
                            /* ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
                            .typing-indicator {
                                display: flex;
                                align-items: center;
                                gap: 5px;
                                padding: 15px;
                            }
                            
                            .typing-dot {
                                width: 8px;
                                height: 8px;
                                background: #999;
                                border-radius: 50%;
                                animation: typing 1.4s infinite ease-in-out;
                            }
                            
                            .typing-dot:nth-child(1) { animation-delay: -0.32s; }
                            .typing-dot:nth-child(2) { animation-delay: -0.16s; }
                            
                            @keyframes typing {
                                0%, 80%, 100% {
                                    transform: scale(0.8);
                                    opacity: 0.5;
                                }
                                40% {
                                    transform: scale(1);
                                    opacity: 1;
                                }
                            }
                            
                            /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
                            .chat-messages::-webkit-scrollbar {
                                width: 8px;
                            }
                            
                            .chat-messages::-webkit-scrollbar-track {
                                background: #f1f1f1;
                            }
                            
                            .chat-messages::-webkit-scrollbar-thumb {
                                background: #888;
                                border-radius: 4px;
                            }
                            
                            .chat-messages::-webkit-scrollbar-thumb:hover {
                                background: #555;
                            }
                            
                            /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
                            @media (max-width: 768px) {
                                .ai-chat-container {
                                    height: 500px;
                                }
                                
                                .message-content {
                                    max-width: 85%;
                                }
                                
                                .message-avatar {
                                    width: 35px;
                                    height: 35px;
                                    font-size: 1.2em;
                                }
                            }
                            </style>
                        </div>
                    </div>
                </div>
                
                <!-- å¤‰çŠ¶ãƒ»ä¸å®‰å®šæ€§è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚¿ãƒ–ã®å¤–ã«ç‹¬ç«‹ï¼‰ -->
                <div class="checklist" style="margin-top: 20px;">
                    <h4>ğŸ“Š å¤‰çŠ¶ãƒ»ä¸å®‰å®šæ€§ã®è©³ç´°</h4>
                    <div style="overflow-x: auto;">
                        <table class="detail-table">
                            <thead>
                                <tr>
                                    <th rowspan="2" style="width: 100px;">ã®ã‚Šé¢ç®¡ç†ç•ªå·</th>
                                    <th rowspan="2" style="width: 120px;">ã‚­ãƒ­ç¨‹</th>
                                    <th rowspan="2" style="width: 200px;">åˆ¤å®šã®è¦å› </th>
                                    <th rowspan="2">è©³ç´°</th>
                                    <th rowspan="2" style="width: 60px;">å†™çœŸ</th>
                                    <th rowspan="2" style="width: 80px;">ç‰¹è¨˜å‚ç…§</th>
                                    <th rowspan="2" style="width: 60px;">é€²è¡Œã®<br>æœ‰ç„¡</th>
                                    <th rowspan="2" style="width: 80px;">ç·šè·¯ã¸ã®<br>å½±éŸ¿åº¦</th>
                                    <th colspan="3" style="width: 180px;">å¥å…¨åº¦åˆ¤å®š</th>
                                </tr>
                                <tr>
                                    <th style="width: 60px;">'20</th>
                                    <th style="width: 60px;">'22</th>
                                    <th style="width: 60px;">'24</th>
                                </tr>
                            </thead>
                            <tbody id="detailTableBody">
                                <tr class="defect-category">
                                    <td colspan="11" style="background: #e3f2fd; font-weight: bold;">å¤‰çŠ¶</td>
                                </tr>
                                <tr class="instability-category">
                                    <td colspan="11" style="background: #fff3e0; font-weight: bold;">ä¸å®‰å®šæ€§</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå¤‰çŠ¶ç™»éŒ²ï¼‰ -->
    <div class="modal-overlay" id="defectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ” å¤‰çŠ¶ã®ç™»éŒ²</h3>
                <button class="modal-close" onclick="closeModal('defectModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>å¤‰çŠ¶ã®ç¨®é¡</label>
                    <select id="defectType" style="width: 100%;">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <optgroup label="åœŸæ§‹é€ ç‰©æœ¬ä½“">
                            <option value="ãè£‚">ãè£‚</option>
                            <option value="ã¯ã‚‰ã¿">ã¯ã‚‰ã¿</option>
                            <option value="æ²ˆä¸‹ãƒ»ã™ã¹ã‚Š">æ²ˆä¸‹ãƒ»ã™ã¹ã‚Š</option>
                            <option value="é™¥æ²¡">é™¥æ²¡</option>
                            <option value="æ´—æ˜">æ´—æ˜</option>
                            <option value="ã‚¬ãƒªãƒ»ã‚„ã›ãƒ»æ¤ç”Ÿä¸æ´»ç€">ã‚¬ãƒªãƒ»ã‚„ã›ãƒ»æ¤ç”Ÿä¸æ´»ç€</option>
                        </optgroup>
                        <optgroup label="é˜²è­·è¨­å‚™">
                            <option value="ã®ã‚Šé¢å·¥ã®é™¥æ²¡ãƒ»ä¸é™¸">ã®ã‚Šé¢å·¥ã®é™¥æ²¡ãƒ»ä¸é™¸</option>
                            <option value="ã®ã‚Šé¢å·¥ã®æµ®ã">ã®ã‚Šé¢å·¥ã®æµ®ã</option>
                            <option value="ã®ã‚Šé¢å·¥ã®ãè£‚">ã®ã‚Šé¢å·¥ã®ãè£‚</option>
                            <option value="ã®ã‚Šé¢å·¥ã®é£Ÿã„é•ã„">ã®ã‚Šé¢å·¥ã®é£Ÿã„é•ã„</option>
                            <option value="åœŸç•™å£ãƒ»çŸ³ç©å£ã®æ²ˆä¸‹">åœŸç•™å£ãƒ»çŸ³ç©å£ã®æ²ˆä¸‹</option>
                            <option value="åœŸç•™å£ãƒ»çŸ³ç©å£ã®å‚¾æ–œ">åœŸç•™å£ãƒ»çŸ³ç©å£ã®å‚¾æ–œ</option>
                            <option value="åœŸç•™å£ãƒ»çŸ³ç©å£ã®é£Ÿã„é•ã„">åœŸç•™å£ãƒ»çŸ³ç©å£ã®é£Ÿã„é•ã„</option>
                            <option value="åœŸç•™å£ãƒ»çŸ³ç©å£ã®ãè£‚ãƒ»ç›®åœ°åˆ‡ã‚Œ">åœŸç•™å£ãƒ»çŸ³ç©å£ã®ãè£‚ãƒ»ç›®åœ°åˆ‡ã‚Œ</option>
                        </optgroup>
                        <optgroup label="æ’æ°´è¨­å‚™">
                            <option value="æ’æ°´è¨­å‚™ã®ç ´æ">æ’æ°´è¨­å‚™ã®ç ´æ</option>
                            <option value="æ’æ°´è¨­å‚™ã®é£Ÿã„é•ã„">æ’æ°´è¨­å‚™ã®é£Ÿã„é•ã„</option>
                            <option value="æ’æ°´è¨­å‚™ã®é€šæ°´ä¸è‰¯">æ’æ°´è¨­å‚™ã®é€šæ°´ä¸è‰¯</option>
                            <option value="åœŸç ‚ãƒ»è½è‘‰ã®å †ç©">åœŸç ‚ãƒ»è½è‘‰ã®å †ç©</option>
                            <option value="æº¢æ°´ã®è·¡">æº¢æ°´ã®è·¡</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>ç™ºç”Ÿä½ç½®ï¼ˆã‚­ãƒ­ç¨‹ï¼‰</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="defectKm" min="0" placeholder="1" style="width: 80px;">
                        <span>k</span>
                        <input type="number" id="defectM" min="0" max="999" placeholder="480" style="width: 100px;">
                        <span>mä»˜è¿‘</span>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>è©³ç´°ï¼ˆä»»æ„ï¼‰</label>
                    <textarea id="defectDetail" placeholder="ä¾‹ï¼šå¹ä»˜å·¥ä¸Šæ–¹ã€çŒæœ¨ã®æˆé•·ã«ã‚ˆã‚‹ãè£‚ã¨æµ®ã" style="width: 100%; min-height: 80px;"></textarea>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>ğŸ“¸ å†™çœŸï¼ˆä»»æ„ï¼‰</label>
                    <div class="photo-upload-mini">
                        <div class="upload-area-mini" onclick="document.getElementById('defectPhotoInput').click()">
                            <div style="font-size: 2em;">ğŸ“·</div>
                            <p style="margin: 5px 0; font-size: 0.9em;">ã‚¯ãƒªãƒƒã‚¯ã—ã¦å†™çœŸã‚’è¿½åŠ </p>
                        </div>
                        <input type="file" id="defectPhotoInput" accept="image/*" multiple style="display: none;" onchange="handleDefectPhotoUpload(event)">
                        <div class="photo-preview-mini" id="defectPhotoPreview"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-button" onclick="closeModal('defectModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="register-button defect" onclick="registerDefect()">ç™»éŒ²</button>
            </div>
        </div>
    </div>
    
    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆä¸å®‰å®šæ€§ç™»éŒ²ï¼‰ -->
    <div class="modal-overlay" id="instabilityModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âš ï¸ ä¸å®‰å®šæ€§ã®ç™»éŒ²</h3>
                <button class="modal-close" onclick="closeModal('instabilityModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ä¸å®‰å®šè¦å› ã®ç¨®é¡</label>
                    <select id="instabilityType" style="width: 100%;">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <optgroup label="ç«‹åœ°æ¡ä»¶ãƒ»å‘¨è¾ºç’°å¢ƒ">
                            <option value="ç‰‡åˆ‡ç‰‡ç››">ç‰‡åˆ‡ç‰‡ç››</option>
                            <option value="åˆ‡ç››å¢ƒç•Œ">åˆ‡ç››å¢ƒç•Œ</option>
                            <option value="è…¹ä»˜ç››åœŸ">è…¹ä»˜ç››åœŸ</option>
                            <option value="è½è¾¼å‹¾é…ç‚¹">è½è¾¼å‹¾é…ç‚¹</option>
                            <option value="è°·æ¸¡ã‚Šç››åœŸ">è°·æ¸¡ã‚Šç››åœŸ</option>
                            <option value="å‚¾æ–œåœ°ç›¤ä¸Šã®ç››åœŸ">å‚¾æ–œåœ°ç›¤ä¸Šã®ç››åœŸ</option>
                            <option value="è»Ÿå¼±åœ°ç›¤ã®ç››åœŸ">è»Ÿå¼±åœ°ç›¤ã®ç››åœŸ</option>
                            <option value="ä¸å®‰å®šåœ°ç›¤ã®ç››åœŸ">ä¸å®‰å®šåœ°ç›¤ï¼ˆå´–éŒã€åœ°ã™ã¹ã‚Šåœ°ç­‰ï¼‰ã®ç››åœŸ</option>
                            <option value="æ©‹å°è£ã¨ã®æ¥åˆéƒ¨">æ©‹å°è£ã¨ã®æ¥åˆéƒ¨</option>
                            <option value="ã‚«ãƒ«ãƒãƒ¼ãƒˆç­‰ã¨ã®æ¥åˆéƒ¨">ã‚«ãƒ«ãƒãƒ¼ãƒˆç­‰ã¨ã®æ¥åˆéƒ¨</option>
                            <option value="ç’°å¢ƒã®å¤‰åŒ–ï¼ˆä¼æ¡ï¼‰">ç’°å¢ƒã®å¤‰åŒ–ï¼ˆä¼æ¡ï¼‰</option>
                            <option value="ç’°å¢ƒã®å¤‰åŒ–ï¼ˆé–‹ç™ºï¼‰">ç’°å¢ƒã®å¤‰åŒ–ï¼ˆé“è·¯ã‚„å®…åœ°ç­‰ã®é–‹ç™ºï¼‰</option>
                        </optgroup>
                        <optgroup label="ç››åœŸãƒ»æ’æ°´è¨­å‚™ãƒ»ä»˜å¸¯è¨­å‚™">
                            <option value="ã®ã‚Šé¢ãŒå¸¸ã«æ¹¿æ½¤">ã®ã‚Šé¢ãŒå¸¸ã«æ¹¿æ½¤</option>
                            <option value="ã®ã‚Šé¢ã‹ã‚‰æ¹§æ°´ãŒã‚ã‚‹">ã®ã‚Šé¢ã‹ã‚‰æ¹§æ°´ãŒã‚ã‚‹</option>
                            <option value="ç™ºç”Ÿãƒãƒ©ã‚¹ãƒˆã®æ•£å¸ƒ">ç™ºç”Ÿãƒãƒ©ã‚¹ãƒˆã®æ•£å¸ƒ</option>
                            <option value="æ’æ°´è¨­å‚™ã®å®¹é‡ä¸è¶³">æ’æ°´è¨­å‚™ã®å®¹é‡ä¸è¶³</option>
                            <option value="æ’æ°´ãƒ‘ã‚¤ãƒ—ç­‰ã‹ã‚‰åœŸç ‚ãŒæµå‡º">æ’æ°´ãƒ‘ã‚¤ãƒ—ç­‰ã‹ã‚‰åœŸç ‚ãŒæµå‡º</option>
                            <option value="ä»˜å¸¯è¨­å‚™å‘¨è¾ºã‹ã‚‰ã®é›¨æ°´æµå…¥">ä»˜å¸¯è¨­å‚™ã®å‘¨è¾ºã‹ã‚‰ç››åœŸã®ã‚Šé¢ã¸ã®é›¨æ°´ã®æµå…¥ã€æµä¸‹</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>ä½ç½®ï¼ˆã‚­ãƒ­ç¨‹ã¾ãŸã¯ç¯„å›²ï¼‰</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="instabilityLocation" placeholder="ä¾‹ï¼š1k450mä»˜è¿‘ã€å…¨åŸŸ" style="width: 100%;">
                    </div>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>è©³ç´°ï¼ˆä»»æ„ï¼‰</label>
                    <textarea id="instabilityDetail" placeholder="ä¾‹ï¼šå¹ä»˜å·¥éšæ®µã®è¸Šã‚Šå ´ä»˜è¿‘ã€‚å¹ä»˜å·¥å£é¢ã‹ã‚‰å¸¸æ™‚æ¹§æ°´ãŒèªã‚ã‚‰ã‚Œã‚‹ã€‚" style="width: 100%; min-height: 80px;"></textarea>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>ğŸ“¸ å†™çœŸï¼ˆä»»æ„ï¼‰</label>
                    <div class="photo-upload-mini">
                        <div class="upload-area-mini" onclick="document.getElementById('instabilityPhotoInput').click()">
                            <div style="font-size: 2em;">ğŸ“·</div>
                            <p style="margin: 5px 0; font-size: 0.9em;">ã‚¯ãƒªãƒƒã‚¯ã—ã¦å†™çœŸã‚’è¿½åŠ </p>
                        </div>
                        <input type="file" id="instabilityPhotoInput" accept="image/*" multiple style="display: none;" onchange="handleInstabilityPhotoUpload(event)">
                        <div class="photo-preview-mini" id="instabilityPhotoPreview"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-button" onclick="closeModal('instabilityModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="register-button instability" onclick="registerInstability()">ç™»éŒ²</button>
            </div>
        </div>
    </div>
    
    <!-- APIè¨­å®šãƒœã‚¿ãƒ³ -->
    <button onclick="showAPIKeySettings()" 
            style="position: fixed; bottom: 20px; right: 20px; 
                   background: #4CAF50; color: white; 
                   padding: 10px 20px; border-radius: 25px; 
                   border: none; cursor: pointer; 
                   box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                   z-index: 1000;">
        âš™ï¸ APIè¨­å®š
    </button>
    
    <script src="railway-scripts.js"></script>
</body>
</html>
